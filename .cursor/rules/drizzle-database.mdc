---
alwaysApply: true
---

# Drizzle ORM Database Interactions

All database interactions in this project must use **Drizzle ORM** with the schema defined in [src/db/schema.ts](mdc:src/db/schema.ts).

## Database Schema

The application uses the following tables:

- **decksTable** - Stores flashcard decks with userId (Clerk), name, description, and timestamps
- **cardsTable** - Stores individual flashcards with front/back text, linked to decks via foreign key

## Guidelines

- Always import table schemas from `src/db/schema.ts`
- Use Drizzle query builder for all database operations (select, insert, update, delete)
- Never write raw SQL queries - use Drizzle's type-safe query methods
- Use the `db` instance from the database configuration file
- Leverage Drizzle's relationships and joins when querying related data
- All queries should be type-safe using Drizzle's TypeScript inference

## Example Usage

```typescript
import { db } from '@/db';
import { decksTable, cardsTable } from '@/db/schema';
import { eq } from 'drizzle-orm';

// Query example
const userDecks = await db.select().from(decksTable).where(eq(decksTable.userId, userId));

// Insert example
const [newDeck] = await db.insert(decksTable).values({
  userId: userId,
  name: "Indonesian Language",
  description: "Learn Indonesian vocabulary"
}).returning();

// Join example
const deckWithCards = await db.select()
  .from(decksTable)
  .leftJoin(cardsTable, eq(cardsTable.deckId, decksTable.id))
  .where(eq(decksTable.id, deckId));
```

## Authentication

- User authentication is handled by **Clerk**
- Store Clerk user IDs (as strings) in the `userId` field
- Always filter queries by the authenticated user's ID to ensure data isolation
